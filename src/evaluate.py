import sys
import json
from rouge import Rouge


def main(fp):
    with open(fp, 'r') as f:
        data = json.load(f)

    outputs, trgs = map(list, zip(*[[d['output'], d['trg']] for d in data]))
    rouge = Rouge()

    scores = rouge.get_scores(outputs, trgs, avg=True)
    print(scores)


def k_best_sentence(fp, k):
    with open(fp, 'r') as f:
        data = json.load(f)

    s = [[d['src'], d['trg'], d['output'], d['score']] for d in data]
    s.sort(key=lambda x: x[3], reverse=True)

    return s[0:k]


if __name__ == '__main__':
    # fp = sys.argv[1]
    fp = "raw_val_500kdps_nondup_01drop_80e_results.json"
    k_best_sentence(fp, 10)
    #main(fp)

    # 500k val 2k nondup 25e 400maxlen:
    # {'rouge-1': {'f': 0.18897557007806556, 'p': 0.20305305545192903, 'r': 0.18724744761087897},
    #  'rouge-2': {'f': 0.050339678667959485, 'p': 0.05207092100597945, 'r': 0.0512156414505305},
    #  'rouge-l': {'f': 0.15689206850469187, 'p': 0.17577284592076592, 'r': 0.16271346860963193}}

    # 500k val 2k nondup 25e 800maxlen:
    # {'rouge-1': {'f': 0.18897557007806556, 'p': 0.20305305545192903, 'r': 0.18724744761087897},
    #  'rouge-2': {'f': 0.050339678667959485, 'p': 0.05207092100597945, 'r': 0.0512156414505305},
    #  'rouge-l': {'f': 0.15689206850469187, 'p': 0.17577284592076592, 'r': 0.16271346860963193}}

    # 500k val 2k nondup 25e:
    # {'rouge-1': {'f': 0.18897557007806556, 'p': 0.20305305545192903, 'r': 0.18724744761087897},
    #  'rouge-2': {'f': 0.050339678667959485, 'p': 0.05207092100597945, 'r': 0.0512156414505305},
    #  'rouge-l': {'f': 0.15689206850469187, 'p': 0.17577284592076592, 'r': 0.16271346860963193}}

    # 500k val 2k nondup 7e 400maxlen:
    # {'rouge-1': {'f': 0.14520231248347043, 'p': 0.1611478649145466, 'r': 0.14098278568904107},
    #  'rouge-2': {'f': 0.02662090830187339, 'p': 0.027931075892057587, 'r': 0.0270560983490012},
    #  'rouge-l': {'f': 0.12039594167991059, 'p': 0.14064499812246314, 'r': 0.12418628857329485}}

    # 500k val 2k nondup 7e 800maxlen:
    # {'rouge-1': {'f': 0.14520231248347043, 'p': 0.1611478649145466, 'r': 0.14098278568904107},
    #  'rouge-2': {'f': 0.02662090830187339, 'p': 0.027931075892057587, 'r': 0.0270560983490012},
    #  'rouge-l': {'f': 0.12039594167991059, 'p': 0.14064499812246314, 'r': 0.12418628857329485}}

    # 500k val 2k nondup 7e:
    # {'rouge-1': {'f': 0.14520231248347043, 'p': 0.1611478649145466, 'r': 0.14098278568904107},
    #  'rouge-2': {'f': 0.02662090830187339, 'p': 0.027931075892057587, 'r': 0.0270560983490012},
    #  'rouge-l': {'f': 0.12039594167991059, 'p': 0.14064499812246314, 'r': 0.12418628857329485}}

    # 250k val 2k nondup:
    # {'rouge-1': {'f': 0.13663401385817275, 'p': 0.15289564793145427, 'r': 0.13589912303679927},
    # 'rouge-2': {'f': 0.04640655672542536, 'p': 0.048993471256020216, 'r': 0.04662199657248852},
    # 'rouge-l': {'f': 0.11747981093534095, 'p': 0.13867968176793816, 'r': 0.12330627959357596}}

    # 200k val 2k nondup 30e 400maxlen:
    # {'rouge-1': {'f': 0.19795349480885563, 'p': 0.20299219069681623, 'r': 0.20247854385313813},
    #  'rouge-2': {'f': 0.07161312911911302, 'p': 0.07128628913385601, 'r': 0.07421852399780639},
    #  'rouge-l': {'f': 0.16851265224372133, 'p': 0.17847832742931183, 'r': 0.17859561546995936}}

    # 200k val 2k nondup 30e 800maxlen:
    # {'rouge-1': {'f': 0.19795110354927564, 'p': 0.20305223050221208, 'r': 0.20241077828537254},
    #  'rouge-2': {'f': 0.07164608844591182, 'p': 0.0713374587244993, 'r': 0.0742356180149004},
    #  'rouge-l': {'f': 0.16856004730537674, 'p': 0.17857408152042195, 'r': 0.17859195246629633}}

    # 200k val 2k nondup 30e:
    # {'rouge-1': {'f': 0.19795110354927564, 'p': 0.20305223050221208, 'r': 0.20241077828537254},
    #  'rouge-2': {'f': 0.07164608844591182, 'p': 0.0713374587244993, 'r': 0.0742356180149004},
    #  'rouge-l': {'f': 0.16856004730537674, 'p': 0.17857408152042195, 'r': 0.17859195246629633}}

    # 200k val 2k nondup 8e 400maxlen:
    # {'rouge-1': {'f': 0.14222893696696293, 'p': 0.16288514025445813, 'r': 0.13510016363132654},
    #  'rouge-2': {'f': 0.02885201157001144, 'p': 0.0319038027181241, 'r': 0.02823506485013636},
    #  'rouge-l': {'f': 0.11726734503154297, 'p': 0.14277130240184446, 'r': 0.11896872255501484}}

    # 200k val 2k nondup 8e 800maxlen:
    # {'rouge-1': {'f': 0.1420622703027268, 'p': 0.16268514025445813, 'r': 0.1349573064884694},
    #  'rouge-2': {'f': 0.02885201157001144, 'p': 0.0319038027181241, 'r': 0.02823506485013636},
    #  'rouge-l': {'f': 0.11718828520248321, 'p': 0.14267130240184445, 'r': 0.11889729398358627}}

    # 200k val 2k nondup 8e:
    # {'rouge-1': {'f': 0.1420622703027268, 'p': 0.16268514025445813, 'r': 0.1349573064884694},
    #  'rouge-2': {'f': 0.02885201157001144, 'p': 0.0319038027181241, 'r': 0.02823506485013636},
    #  'rouge-l': {'f': 0.11718828520248321, 'p': 0.14267130240184445, 'r': 0.11889729398358627}}

    # 100k val 2k nondup 7e:
    # {'rouge-1': {'f': 0.11148263122079768, 'p': 0.13354060612938642, 'r': 0.10422601650418867},
    #  'rouge-2': {'f': 0.020491216943023274, 'p': 0.02280343561510854, 'r': 0.020324964944556646},
    #  'rouge-l': {'f': 0.09124069171103369, 'p': 0.11798481121801302, 'r': 0.09320916266327214}}

    # 300k val 2k:
    # {'rouge-1': {'f': 0.3410146021873541, 'p': 0.34669314002469687, 'r': 0.3429498776449446},
    # 'rouge-2': {'f': 0.22817781417954833, 'p': 0.22787165856399874, 'r': 0.23223260153371092},
    # 'rouge-l': {'f': 0.32466219187140033, 'p': 0.33501119810430685, 'r': 0.3317315009889859}}

    # 300k train 10k:
    # {'rouge-1': {'f': 0.44362625086602536, 'p': 0.4524270251726309, 'r': 0.4435577544001757},
    # 'rouge-2': {'f': 0.32495296506160926, 'p': 0.3250863815243191, 'r': 0.33040700036329007},
    # 'rouge-l': {'f': 0.42886206656787745, 'p': 0.442934035751185, 'r': 0.4346689217630812}}

    # 420k val 2k:
    # {'rouge-1': {'f': 0.32983305296223103, 'p': 0.3447258038382925, 'r': 0.32853459116183187},
    # 'rouge-2': {'f': 0.20042249991454397, 'p': 0.20292387417508376, 'r': 0.2033027284254057},
    # 'rouge-l': {'f': 0.3052426089548176, 'p': 0.3260673850195548, 'r': 0.3116779421402765}}

    # 420k val 10k:
    # {'rouge-1': {'f': 0.3339528305205294, 'p': 0.3482545805391376, 'r': 0.3323359558158714},
    # 'rouge-2': {'f': 0.20583238807454918, 'p': 0.20800305476917202, 'r': 0.20879031642655604},
    # 'rouge-l': {'f': 0.3088649493152765, 'p': 0.32865112084987347, 'r': 0.3147283241029261}}

    # 420k train 2k:
    # {'rouge-1': {'f': 0.4259032574826402, 'p': 0.44093875448141484, 'r': 0.4229250846172106},
    # 'rouge-2': {'f': 0.288034910218587, 'p': 0.2907685241655777, 'r': 0.2913082431132504},
    # 'rouge-l': {'f': 0.4021363866103185, 'p': 0.4231422928660505, 'r': 0.40665722344159627}}
