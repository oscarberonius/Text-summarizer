import sys
import json
from rouge import Rouge


def main(fp):
    with open(fp, 'r') as f:
        data = json.load(f)

    outputs, trgs = map(list, zip(*[[d['output'], d['trg']] for d in data]))
    rouge = Rouge()

    scores = rouge.get_scores(outputs, trgs, avg=True)
    print(scores)


def k_best_sentence(fp, k):
    with open(fp, 'r') as f:
        data = json.load(f)

    s = [[d['src'], d['trg'], d['output'], d['score']] for d in data]
    s.sort(key=lambda x: x[3], reverse=True)

    return s[0:k]


if __name__ == '__main__':
    # fp = sys.argv[1]
    fp = "val_results_420kdps_10kresdps_gd.json"
    k_best_sentence(fp, 10)

    # 300k val 2k:
    # {'rouge-1': {'f': 0.3410146021873541, 'p': 0.34669314002469687, 'r': 0.3429498776449446},
    # 'rouge-2': {'f': 0.22817781417954833, 'p': 0.22787165856399874, 'r': 0.23223260153371092},
    # 'rouge-l': {'f': 0.32466219187140033, 'p': 0.33501119810430685, 'r': 0.3317315009889859}}

    # 300k train 10k:
    # {'rouge-1': {'f': 0.44362625086602536, 'p': 0.4524270251726309, 'r': 0.4435577544001757},
    # 'rouge-2': {'f': 0.32495296506160926, 'p': 0.3250863815243191, 'r': 0.33040700036329007},
    # 'rouge-l': {'f': 0.42886206656787745, 'p': 0.442934035751185, 'r': 0.4346689217630812}}

    # 420k val 2k:
    # {'rouge-1': {'f': 0.32983305296223103, 'p': 0.3447258038382925, 'r': 0.32853459116183187},
    # 'rouge-2': {'f': 0.20042249991454397, 'p': 0.20292387417508376, 'r': 0.2033027284254057},
    # 'rouge-l': {'f': 0.3052426089548176, 'p': 0.3260673850195548, 'r': 0.3116779421402765}}

    # 420k val 10k:
    # {'rouge-1': {'f': 0.3339528305205294, 'p': 0.3482545805391376, 'r': 0.3323359558158714},
    # 'rouge-2': {'f': 0.20583238807454918, 'p': 0.20800305476917202, 'r': 0.20879031642655604},
    # 'rouge-l': {'f': 0.3088649493152765, 'p': 0.32865112084987347, 'r': 0.3147283241029261}}

    # 420k train 2k:
    # {'rouge-1': {'f': 0.4259032574826402, 'p': 0.44093875448141484, 'r': 0.4229250846172106},
    # 'rouge-2': {'f': 0.288034910218587, 'p': 0.2907685241655777, 'r': 0.2913082431132504},
    # 'rouge-l': {'f': 0.4021363866103185, 'p': 0.4231422928660505, 'r': 0.40665722344159627}}
